#!/bin/bash

interface=$(route -n | grep '^0\.0\.0\.0' | awk '{print $8}')

echo -e "\033[1;31m[*] Starting audit ..\033[m"

if [[ -n "$interface" ]];then

	  echo "[*] Interface ethernet.."

	  echo -e "\t[+]\033[1;32m  ${interface}\033[m"

	  echo "[*] Adresse MAC.."

	  echo -e "\t[+]\033[1;32m  $(ifconfig | grep "$interface" | awk '{print $5;}')\033[m"

	  echo "[*] Adresse IP.."
	
  	echo -e "\t[+]\033[1;32m  $(ifconfig | sed -ne '/'${interface}'/ {n;s/[^0-9][^0-9]*\([^ ][^ ]*\).*/\1/;p}') \033[m" 

	  if grep -q "${interface} inet dhcp" /etc/network/interfaces;then

		   echo "[*] Serveur DHCP.. "

		   for srv in $(cat /var/lib/dhcp/dhclient.${interface}.leases|grep "dhcp-server-identifier"| awk '{print $3;}'|tr ';' ' ' | sort -u);do
	
			        echo -e "\t[+]\033[1;32m  ${srv}\033[m"
		   done

    else

       echo -e "\t[+]\033[1;31m  configuration statique!\033[m"

	  fi

	  echo "[*] Gateway .."

	  gateway=$(route -n | grep '^0\.0\.0\.0'| awk '{print $2;}')

	  if [[ -n "$gateway" ]];then

		   echo -e "\t[+]\033[1;32m  $gateway \033[m"

	  else
		
       echo -e "\t[+]\033[1;31m  None !\033[m"

	  fi

	  echo "[*] Serveur DNS .."

	  for srv in $(cat  /etc/resolv.conf |grep 'nameserver' | awk '{print $2;}');do

		    echo -e "\t[+]\033[1;32m  $srv \033[m"

	  done

	  echo "[*] Domaine.."

	  echo -e "\t[+]\033[1;32m  $(cat  /etc/resolv.conf |grep 'domain' | awk '{print $2;}') \033[m"

	  echo "[*] Test de liaison Ethernet .."

	  if ping -c1 "$gateway" > /dev/null 2>&1;then

		    echo -e "\t[+]\033[1;32m  OK ! \033[m"

	  else

		    echo -e "\t[-]\033[1;31m  KO ! \033[m"

	  fi

else

	  echo -e "\t[-]\033[1;31m Interface Ethernet non configuree ! \033[m"

fi

